CREATE DATABASE kitap_sosyal_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE kitap_sosyal_db;
CREATE TABLE users (id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50) NOT NULL UNIQUE, email VARCHAR(100) NOT NULL UNIQUE, password VARCHAR(255) NOT NULL, full_name VARCHAR(100), phone VARCHAR(15), gender ENUM('E', 'K', 'Belirtilmemis') DEFAULT 'Belirtilmemis', birth_date DATE, profile_image VARCHAR(255) DEFAULT 'default.png', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE cached_books (id INT AUTO_INCREMENT PRIMARY KEY, api_book_id VARCHAR(100) NOT NULL UNIQUE, title VARCHAR(255) NOT NULL, author VARCHAR(255), cover_image VARCHAR(255));
CREATE TABLE reviews (id INT AUTO_INCREMENT PRIMARY KEY, user_id INT NOT NULL, book_api_id VARCHAR(100) NOT NULL, rating TINYINT CHECK (rating BETWEEN 1 AND 5), comment TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE);
CREATE TABLE messages (id INT AUTO_INCREMENT PRIMARY KEY, sender_id INT NOT NULL, receiver_id INT NOT NULL, message_content TEXT NOT NULL, is_read BOOLEAN DEFAULT FALSE, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (sender_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY (receiver_id) REFERENCES users(id) ON DELETE CASCADE);
CREATE TABLE follows (follower_id INT NOT NULL, followed_id INT NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, PRIMARY KEY (follower_id, followed_id), FOREIGN KEY (follower_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY (followed_id) REFERENCES users(id) ON DELETE CASCADE);